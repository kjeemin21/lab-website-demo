<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="{{ "/assets/css/style.css" | relative_url }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <title>{{ page.title }} | {{ site.title }}</title>
</head>
<body>
    <header class="site-header">
        <div class="header-container">
            <h1 class="site-title">
                <a href="{{ "/" | relative_url }}">
                    <img src="{{ '/assets/images/icons/logo_bdi_v3.svg' | relative_url }}" alt="{{ site.title }}" class="site-logo">
                    <span class="site-title-text">{{ site.title }}</span>
                </a>
            </h1>
            <nav class="main-nav">
                <button class="tab-button active" data-tab="about">About</button>
                <button class="tab-button" data-tab="professor">Professor</button>
                <button class="tab-button" data-tab="members">Members</button>
                <button class="tab-button" data-tab="publications">Publications</button>
                <button class="tab-button" data-tab="projects">Projects</button>
                <button class="tab-button" data-tab="photos">Photos</button>
                <button class="tab-button" data-tab="recruit">Recruit</button>
            </nav>
            <button class="menu-toggle" aria-label="Toggle menu">
                <img src="{{ '/assets/images/icons/menu_icon.svg' | relative_url }}" alt="Menu" class="menu-icon">
            </button>
        </div>
    </header>

    <!-- Side Menu Overlay -->
    <div class="side-menu-overlay"></div>
    
    <!-- Side Menu -->
    <nav class="side-menu">
        <div class="side-menu-header">
            <button class="menu-close" aria-label="Close menu">
                <span>&times;</span>
            </button>
        </div>
        <ul class="side-menu-list">
            <li><button class="side-menu-tab" data-tab="about">About</button></li>
            <li><button class="side-menu-tab" data-tab="professor">Professor</button></li>
            <li><button class="side-menu-tab" data-tab="members">Members</button></li>
            <li><button class="side-menu-tab" data-tab="publications">Publications</button></li>
            <li><button class="side-menu-tab" data-tab="projects">Projects</button></li>
            <li><button class="side-menu-tab" data-tab="photos">Photos</button></li>
            <li><button class="side-menu-tab" data-tab="recruit">Recruit</button></li>
        </ul>
    </nav>

    <main>
        {{ content }}
    </main>

    <footer class="site-footer">
        <div class="footer-container">
            <p>&copy; {{ site.time | date: "%Y" }} {{ site.title }}. All rights reserved.</p>
            {% if site.github_username %}
            <p>
                <a href="https://github.com/{{ site.github_username }}" target="_blank" rel="noopener">GitHub</a>
            </p>
            {% endif %}
        </div>
    </footer>

    <script>
        // Disable browser's automatic scroll restoration
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        
        // Force scroll to top immediately on script execution
        window.scrollTo(0, 0);
        
        // Menu toggle functionality
        const menuToggle = document.querySelector('.menu-toggle');
        const menuClose = document.querySelector('.menu-close');
        const sideMenu = document.querySelector('.side-menu');
        const sideMenuOverlay = document.querySelector('.side-menu-overlay');

        function openSideMenu() {
            sideMenu.classList.add('active');
            sideMenuOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeSideMenu() {
            sideMenu.classList.remove('active');
            sideMenuOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        if (menuToggle) {
            menuToggle.addEventListener('click', openSideMenu);
        }

        if (menuClose) {
            menuClose.addEventListener('click', closeSideMenu);
        }

        if (sideMenuOverlay) {
            sideMenuOverlay.addEventListener('click', closeSideMenu);
        }

        // Tab switching functionality
        function switchTab(tabId) {
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Remove active class from all side menu tabs
            document.querySelectorAll('.side-menu-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Hide all tab panels
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Show selected tab panel
            const targetPanel = document.querySelector(`#${tabId}.tab-panel`);
            if (targetPanel) {
                targetPanel.classList.add('active');
            }
            
            // Activate corresponding tab button
            const targetTabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
            if (targetTabButton) {
                targetTabButton.classList.add('active');
            }
            
            // Activate corresponding side menu tab
            const targetSideMenuTab = document.querySelector(`.side-menu-tab[data-tab="${tabId}"]`);
            if (targetSideMenuTab) {
                targetSideMenuTab.classList.add('active');
            }
            
            // Update URL hash
            if (history.pushState) {
                history.pushState(null, null, `#${tabId}`);
            } else {
                window.location.hash = `#${tabId}`;
            }
            
            // Scroll to top of main content
            window.scrollTo(0, 0);
            
            // For About tab, ensure scroll stays at top
            if (tabId === 'about') {
                setTimeout(function() {
                    window.scrollTo(0, 0);
                }, 50);
            }
            
            // Initialize publications menu if publications tab is active
            if (tabId === 'publications') {
                setTimeout(function() {
                    initPublicationsMenuWithClose();
                    initPublicationsShowMore();
                }, 100);
            }
            
            // Initialize members menu if members tab is active
            if (tabId === 'members') {
                setTimeout(initMembersMenuWithClose, 100);
            }
            
            // Initialize photo items and pagination if photos tab is active
            if (tabId === 'photos') {
                setTimeout(function() {
                    if (typeof initPhotoItems === 'function') {
                        initPhotoItems();
                    }
                    if (typeof initPhotoPagination === 'function') {
                        initPhotoPagination();
                    }
                }, 100);
            }
            
            // Initialize about animations if about tab is active
            if (tabId === 'about') {
                setTimeout(initAboutAnimations, 100);
            }
        }

        // Tab button click handlers
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        // Side menu tab click handlers
        document.querySelectorAll('.side-menu-tab').forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchTab(tabId);
                closeSideMenu();
            });
        });

        // Handle initial hash on page load
        function handleInitialHash() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                const targetPanel = document.querySelector(`#${hash}.tab-panel`);
                if (targetPanel) {
                    switchTab(hash);
                    return;
                }
            }
            // Default to first tab if no valid hash
            switchTab('about');
            // Ensure scroll is at top for About tab
            window.scrollTo(0, 0);
        }

        // Initialize on page load
        handleInitialHash();
        
        // Also ensure scroll is at top after page fully loads
        window.addEventListener('load', function() {
            const hash = window.location.hash.substring(1);
            if (!hash || hash === 'about') {
                window.scrollTo(0, 0);
            }
        });

        // Handle window resize to maintain scroll position at top for About tab
        let resizeTimeout;
        let lastScrollY = window.scrollY;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                const hash = window.location.hash.substring(1);
                const activeTab = document.querySelector('.tab-panel.active');
                if ((!hash || hash === 'about') && activeTab && activeTab.id === 'about') {
                    // If user was at or near the top before resize, keep them at top
                    // This prevents layout shifts from moving scroll position
                    if (lastScrollY < 50) {
                        window.scrollTo(0, 0);
                    }
                }
                lastScrollY = window.scrollY;
            }, 150);
        });
        
        // Track scroll position to detect if user intentionally scrolled
        window.addEventListener('scroll', function() {
            lastScrollY = window.scrollY;
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function() {
            handleInitialHash();
        });

        // Publications scroll functionality
        function scrollToPublicationSection(sectionId) {
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                const headerHeight = document.querySelector('.site-header')?.offsetHeight || 100;
                const offsetTop = targetSection.offsetTop - headerHeight - 20;
                window.scrollTo({ top: offsetTop, behavior: 'smooth' });
            }
        }

        // Publications menu toggle functionality (for mobile)
        const publicationsMenuToggle = document.querySelector('.publications-menu-toggle');
        const publicationsMenuClose = document.querySelector('.publications-menu-close');
        const publicationsSideMenu = document.querySelector('.publications-side-menu');
        const publicationsMenuOverlay = document.querySelector('.publications-menu-overlay');

        function openPublicationsMenu() {
            if (publicationsSideMenu) {
                publicationsSideMenu.classList.add('active');
            }
            if (publicationsMenuOverlay) {
                publicationsMenuOverlay.classList.add('active');
            }
            if (document.body) {
                document.body.style.overflow = 'hidden';
            }
        }

        function closePublicationsMenu() {
            if (publicationsSideMenu) {
                publicationsSideMenu.classList.remove('active');
            }
            if (publicationsMenuOverlay) {
                publicationsMenuOverlay.classList.remove('active');
            }
            if (document.body) {
                document.body.style.overflow = '';
            }
        }

        if (publicationsMenuToggle) {
            publicationsMenuToggle.addEventListener('click', openPublicationsMenu);
        }

        if (publicationsMenuClose) {
            publicationsMenuClose.addEventListener('click', closePublicationsMenu);
        }

        if (publicationsMenuOverlay) {
            publicationsMenuOverlay.addEventListener('click', closePublicationsMenu);
        }

        // Scroll to section when clicking on a menu button
        function initPublicationsMenuWithClose() {
            const menuButtons = document.querySelectorAll('.publication-menu-btn');

            menuButtons.forEach(button => {
                if (!button.hasAttribute('data-initialized')) {
                    button.setAttribute('data-initialized', 'true');
                    button.addEventListener('click', function() {
                        const sectionId = this.getAttribute('data-scroll');
                        if (sectionId) {
                            scrollToPublicationSection(sectionId);
                            
                            // Update active button
                            menuButtons.forEach(btn => btn.classList.remove('active'));
                            this.classList.add('active');
                            
                            // Close menu on mobile after selection
                            if (window.innerWidth <= 620) {
                                closePublicationsMenu();
                            }
                        }
                    });
                }
            });
            
            // Update active button based on scroll position
            function updateActivePublicationButton() {
                const sections = ['publications-international', 'publications-domestic'];
                const headerHeight = document.querySelector('.site-header')?.offsetHeight || 100;
                const scrollPosition = window.scrollY + headerHeight + 50;
                
                let activeSection = null;
                sections.forEach(sectionId => {
                    const section = document.getElementById(sectionId);
                    if (section && scrollPosition >= section.offsetTop) {
                        activeSection = sectionId;
                    }
                });
                
                if (activeSection) {
                    menuButtons.forEach(btn => {
                        if (btn.getAttribute('data-scroll') === activeSection) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                }
            }
            
            // Update on scroll
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(updateActivePublicationButton, 100);
            });
            
            // Initial update
            updateActivePublicationButton();
        }

        // Publications Show More functionality
        function initPublicationsShowMore() {
            const showMoreButtons = document.querySelectorAll('.publications-show-more-btn');
            
            showMoreButtons.forEach(button => {
                if (!button.hasAttribute('data-initialized')) {
                    button.setAttribute('data-initialized', 'true');
                    button.addEventListener('click', function() {
                        const sectionId = this.getAttribute('data-section');
                        const limit = parseInt(this.getAttribute('data-limit')) || 10;
                        const section = document.getElementById(sectionId);
                        
                        if (!section) return;
                        
                        const allItems = section.querySelectorAll('.publication-item');
                        const showMoreIcon = this.querySelector('.show-more-icon');
                        const showLessIcon = this.querySelector('.show-less-icon');
                        const isExpanded = showMoreIcon.style.display === 'none';
                        
                        if (isExpanded) {
                            // Collapse: hide items beyond limit
                            allItems.forEach((item, index) => {
                                if (index >= limit) {
                                    item.classList.add('publication-item-hidden');
                                }
                            });
                            showMoreIcon.style.display = 'block';
                            showLessIcon.style.display = 'none';
                        } else {
                            // Expand: show all hidden items
                            allItems.forEach((item, index) => {
                                if (index >= limit) {
                                    item.classList.remove('publication-item-hidden');
                                }
                            });
                            showMoreIcon.style.display = 'none';
                            showLessIcon.style.display = 'block';
                        }
                    });
                }
            });
        }

        // Members scroll functionality
        function scrollToMemberSection(sectionId) {
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                const headerHeight = document.querySelector('.site-header')?.offsetHeight || 100;
                const offsetTop = targetSection.offsetTop - headerHeight - 20;
                window.scrollTo({ top: offsetTop, behavior: 'smooth' });
            }
        }

        // Members menu toggle functionality (for mobile)
        const membersMenuToggle = document.querySelector('.members-menu-toggle');
        const membersMenuClose = document.querySelector('.members-menu-close');
        const membersSideMenu = document.querySelector('.members-side-menu');
        const membersMenuOverlay = document.querySelector('.members-menu-overlay');

        function openMembersMenu() {
            if (membersSideMenu) {
                membersSideMenu.classList.add('active');
            }
            if (membersMenuOverlay) {
                membersMenuOverlay.classList.add('active');
            }
            if (document.body) {
                document.body.style.overflow = 'hidden';
            }
        }

        function closeMembersMenu() {
            if (membersSideMenu) {
                membersSideMenu.classList.remove('active');
            }
            if (membersMenuOverlay) {
                membersMenuOverlay.classList.remove('active');
            }
            if (document.body) {
                document.body.style.overflow = '';
            }
        }

        if (membersMenuToggle) {
            membersMenuToggle.addEventListener('click', openMembersMenu);
        }

        if (membersMenuClose) {
            membersMenuClose.addEventListener('click', closeMembersMenu);
        }

        if (membersMenuOverlay) {
            membersMenuOverlay.addEventListener('click', closeMembersMenu);
        }

        // Scroll to section when clicking on a menu button
        function initMembersMenuWithClose() {
            const menuButtons = document.querySelectorAll('.member-menu-btn');

            menuButtons.forEach(button => {
                if (!button.hasAttribute('data-initialized')) {
                    button.setAttribute('data-initialized', 'true');
                    button.addEventListener('click', function() {
                        const sectionId = this.getAttribute('data-scroll');
                        if (sectionId) {
                            scrollToMemberSection(sectionId);
                            
                            // Update active button
                            menuButtons.forEach(btn => btn.classList.remove('active'));
                            this.classList.add('active');
                            
                            // Close menu on mobile after selection
                            if (window.innerWidth <= 620) {
                                closeMembersMenu();
                            }
                        }
                    });
                }
            });
            
            // Update active button based on scroll position
            function updateActiveMemberButton() {
                const sections = ['members-phd', 'members-ms', 'members-alumni'];
                const headerHeight = document.querySelector('.site-header')?.offsetHeight || 100;
                const scrollPosition = window.scrollY + headerHeight + 50;
                
                let activeSection = null;
                sections.forEach(sectionId => {
                    const section = document.getElementById(sectionId);
                    if (section && scrollPosition >= section.offsetTop) {
                        activeSection = sectionId;
                    }
                });
                
                if (activeSection) {
                    menuButtons.forEach(btn => {
                        if (btn.getAttribute('data-scroll') === activeSection) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                }
            }
            
            // Update on scroll
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(updateActiveMemberButton, 100);
            });
            
            // Initial update
            updateActiveMemberButton();
        }

        // Recent News Slider functionality
        let currentSlideIndex = 0;
        let slidesPerView = 3;
        let recentNewsTrack = null;
        let recentNewsItems = [];
        let totalSlides = 0;
        let maxSlideIndex = 0;

        function initRecentNewsSlider() {
            recentNewsTrack = document.querySelector('.recent-news-track');
            recentNewsItems = document.querySelectorAll('.recent-news-item');
            
            if (!recentNewsTrack || recentNewsItems.length === 0) return;
            
            totalSlides = recentNewsItems.length;
            updateSlidesPerView();
            updateSliderPosition();
            updateSliderButtons();
            
            // Add resize listener to update slides per view
            window.addEventListener('resize', function() {
                updateSlidesPerView();
                updateSliderPosition();
                updateSliderButtons();
            });
        }

        function updateSlidesPerView() {
            const width = window.innerWidth;
            if (width <= 768) {
                slidesPerView = 1;
            } else if (width <= 1024) {
                slidesPerView = 2;
            } else {
                slidesPerView = 3;
            }
            maxSlideIndex = Math.max(0, totalSlides - slidesPerView);
        }

        function updateSliderPosition() {
            if (!recentNewsTrack) return;
            
            // Ensure currentSlideIndex is within valid range
            currentSlideIndex = Math.max(0, Math.min(currentSlideIndex, maxSlideIndex));
            
            const slideWidth = recentNewsItems[0]?.offsetWidth || 0;
            const gap = 20;
            const offset = -(currentSlideIndex * (slideWidth + gap));
            recentNewsTrack.style.transform = `translateX(${offset}px)`;
        }

        function updateSliderButtons() {
            const prevBtn = document.querySelector('.slider-nav-prev');
            const nextBtn = document.querySelector('.slider-nav-next');
            
            if (prevBtn) {
                prevBtn.disabled = currentSlideIndex <= 0;
            }
            
            if (nextBtn) {
                nextBtn.disabled = currentSlideIndex >= maxSlideIndex;
            }
        }

        function slideNext() {
            if (currentSlideIndex < maxSlideIndex) {
                currentSlideIndex++;
                updateSliderPosition();
                updateSliderButtons();
            }
        }

        function slidePrev() {
            if (currentSlideIndex > 0) {
                currentSlideIndex--;
                updateSliderPosition();
                updateSliderButtons();
            }
        }

        // Add event listeners for slider buttons
        const sliderPrevBtn = document.querySelector('.slider-nav-prev');
        const sliderNextBtn = document.querySelector('.slider-nav-next');
        
        if (sliderPrevBtn) {
            sliderPrevBtn.addEventListener('click', slidePrev);
        }
        
        if (sliderNextBtn) {
            sliderNextBtn.addEventListener('click', slideNext);
        }

        // About section scroll-based animations
        function initAboutAnimations() {
            // Force scroll to top when initializing About animations
            window.scrollTo(0, 0);
            
            // Initialize Recent News Slider
            initRecentNewsSlider();
        }

        // Also initialize on page load if publications or members tab is active
        document.addEventListener('DOMContentLoaded', function() {
            const hash = window.location.hash.substring(1);
            
            // Force scroll to top for About tab or no hash
            if (!hash || hash === 'about') {
                window.scrollTo(0, 0);
            }
            
            if (hash === 'publications' || (!hash && document.querySelector('#publications.tab-panel.active'))) {
                setTimeout(function() {
                    initPublicationsMenuWithClose();
                    initPublicationsShowMore();
                }, 100);
            }
            if (hash === 'members' || (!hash && document.querySelector('#members.tab-panel.active'))) {
                setTimeout(initMembersMenuWithClose, 100);
            }
            if (hash === 'about' || (!hash && document.querySelector('#about.tab-panel.active'))) {
                setTimeout(function() {
                    initAboutAnimations();
                    // Double-check scroll position after animations init
                    setTimeout(function() {
                        window.scrollTo(0, 0);
                    }, 50);
                }, 100);
            }
        });

        // Photo Lightbox functionality
        const photoLightbox = document.getElementById('photoLightbox');
        const lightboxImage = document.getElementById('lightboxImage');
        const lightboxClose = document.querySelector('.photo-lightbox-close');
        let photoItems = document.querySelectorAll('.photo-item');

        function openPhotoLightbox(imageSrc, clickedImg) {
            if (!lightboxImage || !photoLightbox) return;
            
            // Set image source
            lightboxImage.src = imageSrc;
            
            // Show lightbox with fade-in and scale effect
            photoLightbox.style.visibility = 'visible';
            photoLightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closePhotoLightbox() {
            if (!photoLightbox) return;

            // Add closing class for fade-out effect
            photoLightbox.classList.add('closing');
            photoLightbox.classList.remove('active');
            
            // Wait for animation to complete before hiding
            setTimeout(() => {
                photoLightbox.classList.remove('closing');
                photoLightbox.style.visibility = 'hidden';
                document.body.style.overflow = '';
            }, 300);
        }

        // Add click handlers to photo items
        function initPhotoItems() {
            photoItems = document.querySelectorAll('.photo-item');
            photoItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    const img = this.querySelector('img');
                    if (img) {
                        const imageSrc = this.getAttribute('data-image') || img.src;
                        if (imageSrc) {
                            openPhotoLightbox(imageSrc, img);
                        }
                    }
                });
            });
        }

        // Initialize photo items
        initPhotoItems();

        // Re-initialize when photos tab is opened
        const originalSwitchTab = window.switchTab;
        if (typeof switchTab === 'function') {
            // This will be handled by the existing switchTab function
        }

        // Also initialize on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            initPhotoItems();
        });

        // Close lightbox handlers
        if (lightboxClose) {
            lightboxClose.addEventListener('click', closePhotoLightbox);
        }

        if (photoLightbox) {
            photoLightbox.addEventListener('click', function(e) {
                if (e.target === photoLightbox) {
                    closePhotoLightbox();
                }
            });
        }

        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && photoLightbox && photoLightbox.classList.contains('active')) {
                closePhotoLightbox();
            }
        });

        // Photo Pagination functionality
        const photosPerPage = 9;
        let currentPhotoPage = 1;
        let totalPhotoItems = 0;
        let totalPhotoPages = 1;

        function initPhotoPagination() {
            const allPhotoItems = document.querySelectorAll('.photo-item');
            totalPhotoItems = allPhotoItems.length;
            totalPhotoPages = Math.ceil(totalPhotoItems / photosPerPage);
            
            if (totalPhotoPages <= 1) {
                // Hide pagination if only one page
                const pagination = document.getElementById('photoPagination');
                if (pagination) {
                    pagination.style.display = 'none';
                }
                return;
            } else {
                const pagination = document.getElementById('photoPagination');
                if (pagination) {
                    pagination.style.display = 'flex';
                }
            }
            
            renderPhotoPagination();
            showPhotoPage(1);
        }

        function showPhotoPage(pageNumber) {
            currentPhotoPage = pageNumber;
            const allPhotoItems = document.querySelectorAll('.photo-item');
            const startIndex = (pageNumber - 1) * photosPerPage;
            const endIndex = startIndex + photosPerPage;
            
            allPhotoItems.forEach((item, index) => {
                if (index >= startIndex && index < endIndex) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
            
            updatePhotoPaginationButtons();
            
            // Scroll to photos section
            const photosSection = document.getElementById('photos');
            if (photosSection) {
                const headerHeight = document.querySelector('.site-header')?.offsetHeight || 100;
                const offsetTop = photosSection.offsetTop - headerHeight - 20;
                window.scrollTo({ top: offsetTop, behavior: 'smooth' });
            }
        }

        function renderPhotoPagination() {
            const paginationNumbers = document.getElementById('photoPaginationNumbers');
            if (!paginationNumbers) return;
            
            paginationNumbers.innerHTML = '';
            
            for (let i = 1; i <= totalPhotoPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-number';
                pageBtn.textContent = i;
                pageBtn.setAttribute('data-page', i);
                
                if (i === currentPhotoPage) {
                    pageBtn.classList.add('active');
                }
                
                pageBtn.addEventListener('click', function() {
                    const page = parseInt(this.getAttribute('data-page'));
                    showPhotoPage(page);
                });
                
                paginationNumbers.appendChild(pageBtn);
            }
        }

        function updatePhotoPaginationButtons() {
            const prevBtn = document.getElementById('photoPrevBtn');
            const nextBtn = document.getElementById('photoNextBtn');
            const pageNumbers = document.querySelectorAll('.page-number');
            
            if (prevBtn) {
                prevBtn.disabled = currentPhotoPage === 1;
            }
            
            if (nextBtn) {
                nextBtn.disabled = currentPhotoPage === totalPhotoPages;
            }
            
            pageNumbers.forEach(btn => {
                const page = parseInt(btn.getAttribute('data-page'));
                if (page === currentPhotoPage) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Pagination button handlers
        const photoPrevBtn = document.getElementById('photoPrevBtn');
        const photoNextBtn = document.getElementById('photoNextBtn');
        
        if (photoPrevBtn) {
            photoPrevBtn.addEventListener('click', function() {
                if (currentPhotoPage > 1) {
                    showPhotoPage(currentPhotoPage - 1);
                }
            });
        }
        
        if (photoNextBtn) {
            photoNextBtn.addEventListener('click', function() {
                if (currentPhotoPage < totalPhotoPages) {
                    showPhotoPage(currentPhotoPage + 1);
                }
            });
        }

        // Initialize pagination on page load
        document.addEventListener('DOMContentLoaded', function() {
            initPhotoPagination();
        });

        // Re-initialize when photos tab is activated
        const originalSwitchTabForPagination = window.switchTab;
    </script>
</body>
</html>
