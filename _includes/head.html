<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="title" content="{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}">
    <meta name="description" content="{% if page.description %}{{ page.description | strip_html | strip_newlines | truncate: 160 }}{% elsif site.data.about.description %}{{ site.data.about.description | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    <meta name="keywords" content="{% if page.keywords %}{{ page.keywords }}{% else %}{{ site.keywords }}{% endif %}">
    <meta name="author" content="{% if page.author %}{{ page.author }}{% else %}{{ site.author }}{% endif %}">
    <meta name="language" content="{{ site.language }}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}">
    <meta property="og:description" content="{% if page.description %}{{ page.description | strip_html | strip_newlines | truncate: 160 }}{% elsif site.data.about.description %}{{ site.data.about.description | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    <meta property="og:image" content="{% if page.image %}{{ page.image | prepend: site.baseurl | prepend: site.url }}{% elsif site.data.about.hero_image %}{{ site.data.about.hero_image | prepend: site.baseurl | prepend: site.url }}{% else %}{{ '/assets/images/about/대표_이미지.png' | prepend: site.baseurl | prepend: site.url }}{% endif %}">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta property="og:locale" content="ko_KR">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}">
    <meta name="twitter:description" content="{% if page.description %}{{ page.description | strip_html | strip_newlines | truncate: 160 }}{% elsif site.data.about.description %}{{ site.data.about.description | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    <meta name="twitter:image" content="{% if page.image %}{{ page.image | prepend: site.baseurl | prepend: site.url }}{% elsif site.data.about.hero_image %}{{ site.data.about.hero_image | prepend: site.baseurl | prepend: site.url }}{% else %}{{ '/assets/images/about/대표_이미지.png' | prepend: site.baseurl | prepend: site.url }}{% endif %}">
    {% if site.twitter_username and site.twitter_username != "None" %}
    <meta name="twitter:creator" content="@{{ site.twitter_username }}">
    {% endif %}
    
    <!-- Favicon -->
    <!-- Standard favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="{{ "/assets/images/favicons/favicon-16x16.png" | relative_url }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ "/assets/images/favicons/favicon-32x32.png" | relative_url }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ "/assets/images/favicons/favicon-96x96.png" | relative_url }}">
    <link rel="icon" type="image/x-icon" href="{{ "/assets/images/favicons/favicon.ico" | relative_url }}">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="72x72" href="{{ "/assets/images/favicons/apple-icon-72x72.png" | relative_url }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ "/assets/images/favicons/apple-icon-180x180.png" | relative_url }}">
    
    <!-- Android Icons -->
    <link rel="icon" type="image/png" sizes="36x36" href="{{ "/assets/images/favicons/android-icon-36x36.png" | relative_url }}">
    <link rel="icon" type="image/png" sizes="72x72" href="{{ "/assets/images/favicons/android-icon-72x72.png" | relative_url }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ "/assets/images/favicons/android-icon-192x192.png" | relative_url }}">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="{{ "/assets/images/favicons/ms-icon-150x150.png" | relative_url }}">
    <meta name="msapplication-square70x70logo" content="{{ "/assets/images/favicons/ms-icon-70x70.png" | relative_url }}">
    <meta name="msapplication-square150x150logo" content="{{ "/assets/images/favicons/ms-icon-150x150.png" | relative_url }}">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="{{ "/assets/css/style.css" | relative_url }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "{{ site.title }}",
      "url": "{{ site.url }}{{ site.baseurl }}",
      "logo": "{{ site.url }}{{ site.baseurl }}/assets/images/icons/logo_bdi_v3.svg",
      "description": "{% if site.data.about.description %}{{ site.data.about.description | strip_html | strip_newlines | truncate: 200 }}{% else %}{{ site.description }}{% endif %}",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Daejeon",
        "addressCountry": "KR"
      },
      "sameAs": [
        {% if site.github_username %}"https://github.com/{{ site.github_username }}"{% endif %}
      ]
    }
    </script>
    
    {% if site.data.professor %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "{{ site.data.professor.name }}",
      "jobTitle": "{{ site.data.professor.title }}",
      "email": "{{ site.data.professor.email }}",
      "worksFor": {
        "@type": "Organization",
        "name": "KAIST",
        "department": "School of Computing"
      },
      "alumniOf": {
        "@type": "EducationalOrganization",
        "name": "{{ site.data.professor.education.university }}"
      },
      "knowsAbout": "{{ site.data.professor.research_interests }}"
    }
    </script>
    {% endif %}
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "{{ site.title }}",
      "url": "{{ site.url }}{{ site.baseurl }}",
      "description": "{% if site.data.about.description %}{{ site.data.about.description | strip_html | strip_newlines | truncate: 200 }}{% else %}{{ site.description }}{% endif %}"
    }
    </script>
    
    <!-- Prevent tab flickering on page load -->
    <script>
        (function() {
            // Get hash from URL immediately
            var hash = window.location.hash.substring(1);
            var targetTab = hash || 'about';
            
            // Function to set initial tab state
            function setInitialTab() {
                // Remove active class from all tab panels and buttons
                var allPanels = document.querySelectorAll('.tab-panel');
                var allButtons = document.querySelectorAll('.tab-button');
                var allSideMenuTabs = document.querySelectorAll('.side-menu-tab');
                
                allPanels.forEach(function(panel) {
                    panel.classList.remove('active');
                });
                allButtons.forEach(function(btn) {
                    btn.classList.remove('active');
                });
                allSideMenuTabs.forEach(function(btn) {
                    btn.classList.remove('active');
                });
                
                // Activate the correct tab based on hash
                var targetPanel = document.querySelector('#' + targetTab + '.tab-panel');
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
                
                var targetButton = document.querySelector('.tab-button[data-tab="' + targetTab + '"]');
                if (targetButton) {
                    targetButton.classList.add('active');
                }
                
                var targetSideMenuTab = document.querySelector('.side-menu-tab[data-tab="' + targetTab + '"]');
                if (targetSideMenuTab) {
                    targetSideMenuTab.classList.add('active');
                }
            }
            
            // Try to set tab immediately if DOM is ready
            if (document.readyState === 'loading') {
                // DOM is still loading, wait for DOMContentLoaded
                document.addEventListener('DOMContentLoaded', setInitialTab);
            } else {
                // DOM is already loaded, set tab immediately
                setInitialTab();
            }
        })();
    </script>
</head>
